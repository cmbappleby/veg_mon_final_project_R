---
title: "Arches Vegetation Cover 2010-2023"
author: "Christina Appleby"
format: 
  dashboard:
    orientation: columns
    embed-resources: true
    theme: lumen_mh.scss
    css: styles.css
---

```{r setup, include = F}

knitr::opts_chunk$set(echo = FALSE, message = F, warning = F)
options(knitr.duplicate.label = "allow")

# Install any missing packages
list.of.packages <- c('tidyverse',  'sf', 'leaflet', 'here', 'DT',
                      'gridExtra', 'cowplot', 'viridisLite'
                      )

# Load packages
lapply(list.of.packages, library, character.only = T)
```

```{r map leaflet setup}
map_leaflet <- function(data, center_lat, center_long, zoom, basemap){
  m = leaflet(data = data) %>%
  setView(lat = center_lat, lng = center_long, zoom = zoom)
  
  if (basemap == "osm") {
    m <- m %>%
      addTiles(group = "OpenStreetMap")
  } else {
    m <- m %>%
      addProviderTiles(
        provider = "Esri.WorldImagery",
        group = "ESRI World Imagery"
      )
  }

  m <- m %>%
  addPolylines(data = data,
               weight = 3, color = "darkgreen") %>%
  # addLayersControl(
  #   baseGroups = c('OpenStreetMap', 'ESRI World Imagery')) %>%
  addLegend(data = data,
            position = 'bottomright',
            colors =c('darkgreen'),
            labels = c('Park boundary'),
            title = "Legend",
            opacity = 1)

m
}

```

```{r data import setup, include = F}

### VEG DATA ###
change_plots <- read_csv(here('data/change_plots.csv'))
species_area <- read_csv(here('data/species_area.csv'))
plots_cover_change_species <- read_csv(here('data/plots_veg_cover.csv'))
species_trend <- read_csv(here('data/plot_trend.csv'))

### NCPN PARK BOUNDARIES ###
ncpn_units <-  st_read(here('data/NCPN_unit_boundaries/NCPN_unit_boundaries.shp')) %>% 
  st_transform(crs = 4326)

arches_boundary <- ncpn_units %>%
  filter(UNIT_CODE == 'ARCH')

```

# Overview

## Column intro {width='50%'}

### Row summary {height='35%'}

::: {.card title="NPS Inventory & Monitoring"}
The [National Park Service Inventory & Monitoring Division (IMD)](https://www.nps.gov/im/index.htm) 
consists of 32 networks that gather and analyze inventory and monitoring data, 
and communicate key information on park resources. The monitoring data helps 
park managers understand how the natural resources are changing over time, 
enabling them to make science-based management decisions.

Source: 
Inventory and Monitoring Division (U.S. National Park Service). (n.d.). 
Retrieved December 13, 2025, from [https://www.nps.gov/im/index.htm](https://www.nps.gov/im/index.htm)
:::

### Row ncpn {height='65%'}

::: {.card title="Northern Colorado Plateau Network Uplands"}
The Northern Colorado Plateau Network (NCPN) conducts monitoring 
for 16 different park units. Upland Vegetation and Soils is considered a high 
monitoring priority since most of land on the Colorado Plateau is upland 
ecosystems. Upland areas include rock outcrops, shrublands, grasslands, 
woodlands, forests, badlands, and subalpine meadows. Plant communities, exotic 
invasive species, biological soil crusts, soil stability, and hydrologic 
function are monitored in uplands ecosystems.

Understanding how vegetation cover changes over time helps park managers to 
detect shifts in plant communities, identify at-risk areas, and make informed 
management decisions. This analysis quantifies vegetation cover trends at Arches
National Park as an example of how upland vegetation monitoring can 
provide information for resource management and conservation efforts.

Sources: 
Witwicki D, Thomas H, Weissinger R, Wight A, Topp S, Garman SL, Miller ME. 2017. Upland vegetation and soils monitoring protocol for park units in the Northern Colorado Plateau Network: version 1.07. Natural Resource Report. NPS/NCPN/NRR—2017/1570. National Park Service. Fort Collins, Colorado
[https://irma.nps.gov/DataStore/Reference/Profile/2248124](https://irma.nps.gov/DataStore/Reference/Profile/2248124)

Upland Vegetation and Soils (U.S. National Park Service). (n.d.). Retrieved 
December 13, 2025, from [https://www.nps.gov/im/ncpn/uplands.htm](https://www.nps.gov/im/ncpn/uplands.htm)
:::

## Column ncpn map {width='50%'}

```{r ncpn_map}
cat("title= Map of NCPN Park Units") 

map_leaflet(ncpn_units, '38.931732', '-109.828180', zoom = 7, 'osm')

```

# Study Area

## Column desc {width='45%'}

### arches

::: {.card title='Arches National Park'}
Arches National Park is located north of Moab in Southeast Utah and is part of 
NCPN. Elevation in the park ranges from about 4,000 feet in the canyons to 
5,200 feet on the rims. With an arid climate, the summers are hot and dry, and 
the winters are cool to cold. Average annual precipitation is about 8 inches, 
and temperatures can reach extremes, from -16F to 112F. Most of the park is 
covered by exposed bedrock, weakly developed soils, and sand dunes. The most 
common vegetation type in the park is desert shurblands, but woodlands and 
sparse woodlands are also common.

Sources:
Biophysical Description of Arches National Park (U.S. National Park 
Service). (n.d.). Retrieved December 13, 2025, from 
[https://www.nps.gov/im/ncpn/bpd-arch.htm](https://www.nps.gov/im/ncpn/bpd-arch.htm)

Natural resources monitoring at Arches National Park 
(U.S. National Park Service). (n.d.). Retrieved December 13, 2025, from 
[https://www.nps.gov/im/ncpn/arch.htm](https://www.nps.gov/im/ncpn/arch.htm)
:::

## Column map {width='55%'}

```{r arch_map}
cat("title= Map of Arches") 

map_leaflet(ncpn_units %>% filter(UNIT_CODE == 'ARCH'), 
            '38.710283', '-109.585540', 
            zoom = 11,
            'esri')
```

# Sampling Design & Methods

## Column methods {width='50%'}

::: {.card title='Sampling Design & Field Methods'}
Uplands monitoring began in Arches National Park in 2010 to address the 
management issue of social trailing, and approximately 2,500 hectares are 
monitored. The sampling unit is a plot and consists of three parallel, 50-meter 
transects that are spaced 25 meters apart. To increase the overall sample size, 
a rotating panel design is used where plots are sampled 1-2 years in a row with 
3-6 years of rest.

The point-intercept method is used for estimating vegetation and soil surface 
cover for grassland/shrubland vegetation types. Vegetation and ground 
cover attributes are recorded at 0.5-meter intervals. A laser is used at each 
point, and any vegetation, dead or alive, that the laser intercepts is recorded.
Additionally, vegetation at any height is recorded.

The [Upland Vegetation and Soils Monitoring Protocol](https://irma.nps.gov/DataStore/DownloadFile/593449), 
provides in-depth details about the sampling design.

Sources: 
Hobbs A, Wight A, Livensperger C, Witwicki D, Thomas H, Brehm JR, Miller ME, Weissinger R, Topp S, Garman SL. 2024. Upland Vegetation and Soils Monitoring for the Northern Colorado Plateau Network: 2009-2023 - Data Package. National Park Service. Fort Collins CO
[https://doi.org/10.57830/2305079](https://doi.org/10.57830/2305079)

Witwicki D, Thomas H, Weissinger R, Wight A, Topp S, Garman SL, Miller ME. 2017. Upland vegetation and soils monitoring protocol for park units in the Northern Colorado Plateau Network: version 1.07. Natural Resource Report. NPS/NCPN/NRR—2017/1570. National Park Service. Fort Collins, Colorado
[https://irma.nps.gov/DataStore/Reference/Profile/2248124](https://irma.nps.gov/DataStore/Reference/Profile/2248124)
:::

## Column data imgs {width='50%'}

### Data Collection Example

![Sample Datasheet](../images/data_sheet_example.png){width="95%"}

![Transect Points Associated with Sample Datasheet](../images/transect_points_example.png){width="95%"}
Source: [https://irma.nps.gov/DataStore/DownloadFile/631393](https://irma.nps.gov/DataStore/DownloadFile/631393)

# Analysis {orientation='rows'}

## Row {height='20%'}

### Column {.flow width='33%'}
```{r}
#| content: valuebox
#| title: 'Veg Records'
list(
  icon = 'file-spreadsheet',
  color = 'light',
  value = '1,969'
)
```

### Column {.flow width='34%'}
```{r}
#| content: valuebox
#| title: 'Plots'
list(
  icon = 'pin-map-fill',
  color = 'warning',
  value = '84'
)
```

### Column {.flow width='33%'}
```{r}
#| content: valuebox
#| title: 'Species'
list(
  icon = 'flower1',
  color = 'success',
  value = '106'
)
```

## Row {Height='80%'}

### Column {width='45%'}

::: {.card title='Analysis'}
I downloaded the [NCPN point-intercept CSV](https://irma.nps.gov/DataStore/Reference/Profile/2305079), read it into R, 
filtered for only Arches National Park and live vegetation 
records, then calculated percent cover by species to the plot level.

Since there are 84 plots, I explored the data to look for a meaningful way to 
show vegetation cover change over time for my final product. First, I calculated
the maximum change for 
each species per plot, summed the total change per plot, and reviewed the 
top five plots with the highest change. Next, I calculated the species change 
between the first and last survey years and reviewed the plots/species with the 
greatest change. After this review, I added one 
additional plot to my list of plots with the highest change.

Without spatial data or knowledge of
management actions, I felt the best way to communicate vegetation cover
changes was to show park-level species change instead of plot-level. I converted
the vegetation cover from percentage to area, summed the cover area by species 
and year, and then calculated the percent area change in vegetation cover. Since 
there are 106 different species, I only included the top five species per year 
for my final graph.
:::

### Column {.tabset width='55%'}

#### Veg Cover High Change Plots

```{r change_plot, include = F}
all_species <- unique(change_plots$Species)

change_plots$Species <- factor(change_plots$Species, levels = all_species)

species_colors <- setNames(turbo(length(all_species)), all_species)

graphs_change <- lapply(unique(change_plots$Plot_ID), function(plot_id) {
  
  plot_data <- change_plots %>%
    filter(Plot_ID == plot_id) %>%
    arrange(Visit_Year)
  
  if (nrow(plot_data) == 0) return(NULL)
  
  ggplot(plot_data, 
         aes(x = factor(Visit_Year), y = Cover_pct, fill = Species)) +
    geom_col(position = "stack") +
    scale_fill_manual(values = species_colors, drop = FALSE) +
    labs(title = paste0('Plot ', plot_id),
                  x = "Year",
                  y = "Percent Cover",
                  fill = "Species") +
    theme_minimal() +
    theme(legend.position = 'none')
})

legend_graph <- ggplot(change_plots, 
                       aes(x = Visit_Year, y = Cover_pct, fill = Species)) +
  geom_col(position = "stack") +
    scale_fill_manual(values = species_colors, drop = FALSE) +
    theme_minimal()

legend_all <- get_legend(legend_graph)
```

```{r render_change_graphs}
graphs <- plot_grid(
  plotlist = graphs_change,
  ncol = 3,
  nrow = 2,
  align = 'hv'
)

graphs_legend <- plot_grid(
  plotlist = list(graphs, ggdraw(legend_all)),
  ncol = 2,
  rel_widths = c(8, 2)
)

graphs_legend
```

#### Supporting Tables

```{r change_plots, include = F}
# Find the species with the highest change per plot
high_species_change <- plots_cover_change_species %>%
  group_by(Plot_ID) %>%
  slice_max(Change_cover, n = 1) %>%
  select(Plot_ID, Species, Change_cover)

# Sum change by plot, add species change
change_plots_mod <- plots_cover_change_species %>% 
  filter(Plot_ID %in% c(34, 38, 56, 88, 91, 92)) %>%
  group_by(Plot_ID) %>%
  summarize(
    Change_pct = sum(Change_cover, na.rm = TRUE),
    Num_Species = sum(Change_cover > 0, na.rm = TRUE),
    .groups = 'drop'
  ) %>%
  arrange(desc(Plot_Change_pct)) %>%
  left_join(high_species_change, by = join_by(Plot_ID)) %>%
  mutate(Top_Species_Change_pct = paste0(Species, ' - ', Change_cover)) %>%
  select(-c(Change_cover, Species))

high_trend_down <- species_trend %>%
  arrange(Cover_change) %>%
  slice_head(n = 5)

high_trend <- species_trend %>%
  arrange(desc(Cover_change)) %>%
  slice_head(n = 5) %>%
  bind_rows(high_trend_down) %>%
  select(c(Plot_ID, Species, Cover_change)) %>%
  rename(Cover_Change_pct = Cover_change)
```

```{r plots_dt}
datatable(change_plots_mod, rownames = FALSE, options = list(searching = FALSE))
datatable(high_trend, rownames = FALSE, options = list(searching = FALSE))
```

# Results

# Discussion

